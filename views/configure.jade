extends layout

block headers
	title New Site Configuration

block content
	//- Make sure SOMETHING is set for each config value so we can use them later.
	//- This effectively sets the default values for the configure form
	- if (!config) config = {};
	- if (!config.site_name)                                  config.site_name              = '';
	- if (!config.card_icon_filename)                         config.card_icon_filename     = '';
	- if (!config.card_icon_height)                           config.card_icon_height       = '';
	- if (!config.card_icon_width)                            config.card_icon_width        = '';
	- if (!config.mysql) config.mysql = {};
	- if (!config.mysql.host)                                 config.mysql.host             = 'localhost';
	- if (!config.mysql.port)                                 config.mysql.port             = '3306';
	- if (!config.mysql.database)                             config.mysql.database         = '';
	- if (!config.mysql.username)                             config.mysql.username         = '';
	- if (!config.mysql.password)                             config.mysql.password         = '';
	- if (!config.mysql.connection_limit)                     config.mysql.connection_limit = '100';
	- if (typeof config.invitations_required === 'undefined') config.invitations_required   = true;
	- if (!config.token_length)                               config.token_length           = '50';
	- if (!config.username_length)                            config.username_length        = '63';
	- if (!config.deck_name_length)                           config.deck_name_length       = '63';
	- if (!config.card_text_length)                           config.card_text_length       = '500';

	.container
		.row
			.col-xs-12
				.jumbotron
					if state === "unconfigured"
						- var inputs_disabled = false;
						h1 New Site Configuration
						p
							| Congratulations! Your site is up and running. You just need to do some quick configuration.
						p
							strong However,
							|  keep in mind that "Cards Against Humanity" and the CAH logos are trademarks of Cards Against Humanity
							| LLC. You must use your own name and logos; please do not try to steal theirs.
					else if state === "configuring"
						- var inputs_disabled = true;
						h1 Busy Configuring
						p The site is busy being configured. Try refreshing in a moment when configuration is done.
					else if state === "configured"
						- var inputs_disabled = true;
						h1 Configuration done!
						p Your server has been configured and is ready to use. Restart the server to apply the new configuration.
						p
							| Your configuration has been stored in configuration.json. You can change the configuration at any time by
							| editing that file. 
							strong
								| However, do not edit any of the length properties (such as Token Length or Username Length). These properties
								| are used to create MYSQL tables to set the length of the fields. Changing them will not change the lengths of
								| the MYSQL fields
					if errors
						ul.list-group
							each error in errors
								li.list-group-item.list-group-item-danger #{error.msg}
	div(style='margin: 20px;')
		form(class='form-horizontal', method='POST')
			.form-group
				label(for='site_name_input', class='control-label col-xs-2') Site Name
				.col-xs-10
					input(type='text', class='form-control', id='site_name_input', name='site_name', placeholder='Site Name', value=config.site_name, readonly=inputs_disabled)
			.form-group
				label(for='card_icon_input', class='control-label col-xs-2') Card Icon Filename
				.col-xs-10
					input(type='text', class='form-control', id='card_icon_input', name='card_icon', placeholder='Filename', value=config.card_icon_filename, readonly=inputs_disabled)
					span(class='help-block')
						| The card icon will be placed in the bottom left corner of each card and must be placed in the public/images directory. Keep in mind that cards are 300px tall by 200px
						| wide and must also contain the card text. A good size for this icon might be 35px high by 55px wide.
			.form-group
				label(for='card_icon_height_input', class='control-label col-xs-2') Card Icon Dimensions
				.col-xs-5
					.input-group
						input(type='text', class='form-control', id='card_icon_height_input', name='card_icon_height', placeholder='Height', value=config.card_icon_height, readonly=inputs_disabled)
						span(class='input-group-addon') px
				.col-xs-5
					.input-group
						input(type='text', class='form-control', id='card_icon_width_input', name='card_icon_width', placeholder='Width', value=config.card_icon_width, readonly=inputs_disabled)
						span(class='input-group-addon') px
			.form-group
				label(for='mysql_host_input', class='control-label col-xs-2') MYSQL Host
				.col-xs-10
					input(type='text', class='form-control', id='mysql_host_input', name='mysql_host', placeholder='Host', value=config.mysql.host, readonly=inputs_disabled)
			.form-group
				label(for='mysql_port_input', class='control-label col-xs-2') MYSQL Port
				.col-xs-10
					input(type='text', class='form-control', id='mysql_port_input', name='mysql_port', placeholder='Port', value=config.mysql.port, readonly=inputs_disabled)
			.form-group
				label(for='mysql_database_input', class='control-label col-xs-2') MYSQL DB name
				.col-xs-10
					input(type='text', class='form-control', id='mysql_database_input', name='mysql_database', placeholder='Database', value=config.mysql.database, readonly=inputs_disabled)
			.form-group
				label(for='mysql_username_input', class='control-label col-xs-2') MYSQL Username
				.col-xs-10
					input(type='text', class='form-control', id='mysql_username_input', name='mysql_username', placeholder='Username', value=config.mysql.username, readonly=inputs_disabled)
			.form-group
				label(for='mysql_password_input', class='control-label col-xs-2') MYSQL Password
				.col-xs-10
					input(type='password', class='form-control', id='mysql_password_input', name='mysql_password', placeholder='Password', value=config.mysql.password, readonly=inputs_disabled)
					span(class='help-block') This will be stored in plaintext in configuration.json.
			.form-group
				label(for='mysql_connection_limit_input', class='control-label col-xs-2') MYSQL Connection Limit
				.col-xs-10
					input(type='text', class='form-control', id='mysql_connection_limit_input', name='mysql_connection_limit', placeholder='Limit', value=config.mysql.connection_limit, readonly=inputs_disabled)
			.form-group
				label(for='invitations_required_checkbox', class='control-label col-xs-2') Require Invitations
				.col-xs-10
					input(type='checkbox', class='form-control', style='width: auto;', id='invitations_required_checkbox', name='invitations_required', checked=config.invitations_required, disabled=inputs_disabled)
					span(class='help-block') If invitations are required, only those invited by administrators can make accounts. If invitations are not required, anyone can make an account
			.form-group
				label(for='token_length_input', class='control-label col-xs-2') Token Length
				.col-xs-10
					input(type='text', class='form-control', id='token_length_input', name='token_length', placeholder='Length', value=config.token_length, readonly=inputs_disabled)
					span(class='help-block') Length (in characters) of randomly generated tokens used for things like invitation keys. This number must be even.
			.form-group
				label(for='username_length_input', class='control-label col-xs-2') Username Length
				.col-xs-10
					input(type='text', class='form-control', id='username_length_input', name='username_length', placeholder='Length', value=config.username_length, readonly=inputs_disabled)
					span(class='help-block') Maximum number of characters allowed in usernames.
			.form-group
				label(for='deck_name_length_input', class='control-label col-xs-2') Deck Name Length
				.col-xs-10
					input(type='text', class='form-control', id='deck_name_length_input', name='deck_name_length', placeholder='Length', value=config.deck_name_length, readonly=inputs_disabled)
					span(class='help-block') Maximum number of characters allowed in deck names.
			.form-group
				label(for='card_text_length_input', class='control-label col-xs-2') Card Text Length
				.col-xs-10
					input(type='text', class='form-control', id='card_text_length_input', name='card_text_length', placeholder='Length', value=config.card_text_length, readonly=inputs_disabled)
					span(class='help-block') Maximum number of characters allowed per card.
			.form-group
				.col-xs-offset-2.col-xs-10
					button(type='submit', class='btn btn-primary', disabled=inputs_disabled) Configure Site

