extends layout

block headers
	title New Site Configuration

block content
	//- Make sure SOMETHING is set for each form_data value so we can use them later.
	//- This effectively sets the default values for the configure form
	- if (!form_data) form_data = {};
	- if (typeof form_data.site_name === 'undefined')               form_data.site_name              = '';
	- if (typeof form_data.card_icon_filename === 'undefined')      form_data.card_icon_filename     = '';
	- if (typeof form_data.card_icon_height === 'undefined')        form_data.card_icon_height       = '';
	- if (typeof form_data.card_icon_width === 'undefined')         form_data.card_icon_width        = '';
	- if (!form_data.mysql) form_data.mysql = {};
	- if (typeof form_data.mysql.host === 'undefined')              form_data.mysql.host             = 'localhost';
	- if (typeof form_data.mysql.port === 'undefined')              form_data.mysql.port             = '3306';
	- if (typeof form_data.mysql.database === 'undefined')          form_data.mysql.database         = '';
	- if (typeof form_data.mysql.username === 'undefined')          form_data.mysql.username         = '';
	//- Omit MYSQL password
	- if (typeof form_data.mysql.connection_limit === 'undefined')  form_data.mysql.connection_limit = '100';
	- if (typeof form_data.invitations_required === 'undefined')    form_data.invitations_required   = true;
	- if (typeof form_data.token_length === 'undefined')            form_data.token_length           = '50';
	- if (typeof form_data.username_length === 'undefined')         form_data.username_length        = '63';
	- if (typeof form_data.deck_name_length === 'undefined')        form_data.deck_name_length       = '63';
	- if (typeof form_data.card_text_length === 'undefined')        form_data.card_text_length       = '500';
	- if (typeof form_data.super_user_name === 'undefined')         form_data.super_user_name        = '';
	//- Omit super user password

	//- Find inputs with errors and add the class 'has-error'
	- input_status = {}
	if errors
		each error in errors
			each param in error.param
				- input_status[param] = 'has-error';
	//- If either of the card icon's dimensions have an error, show the error also for the label
	if input_status.card_icon_height || input_status.card_icon_width
		- input_status.card_dimensions = 'text-danger';

	.container
		.row
			.col-xs-12
				.jumbotron
					if state === "unconfigured"
						- var inputs_disabled = false;
						h1 New Site Configuration
						p
							| Congratulations! Your site is up and running. You just need to do some quick configuration.
						p
							strong However,
							|  keep in mind that "Cards Against Humanity" and the CAH logos are trademarks of Cards Against Humanity
							| LLC. You must use your own name and logos; please do not try to steal theirs.
					else if state === "configuring"
						- var inputs_disabled = true;
						h1 Busy Configuring
						p The site is busy being configured. Try refreshing in a moment when configuration is done.
					else if state === "configured"
						- var inputs_disabled = true;
						h1 Configuration done!
						p Your server has been configured and is ready to use. Restart the server to apply the new configuration.
						p
							| Your configuration has been stored in configuration.json. You can change the configuration at any time by
							| editing that file. 
							strong
								| However, do not edit any of the length properties (such as Token Length or Username Length). These properties
								| are used to create MYSQL tables to set the length of the fields. Changing them will not change the lengths of
								| the MYSQL fields
					if errors
						ul.list-group
							each error in errors
								li.list-group-item.list-group-item-danger #{error.msg}
	div(style='margin: 20px;')
		form(class='form-horizontal', method='POST')
			.form-group(class=input_status.site_name)
				label(for='site_name_input', class='control-label col-xs-2') Site Name
				.col-xs-10
					input(type='text', class='form-control', id='site_name_input', name='site_name', placeholder='Site Name', value=form_data.site_name, readonly=inputs_disabled)
			.form-group(class=input_status.card_icon)
				label(for='card_icon_input', class='control-label col-xs-2') Card Icon Filename
				.col-xs-10
					input(type='text', class='form-control', id='card_icon_input', name='card_icon', placeholder='Filename', value=form_data.card_icon_filename, readonly=inputs_disabled)
					span(class='help-block')
						| The card icon will be placed in the bottom left corner of each card and must be placed in the public/images directory. Keep in mind that cards are 300px tall by 200px
						| wide and must also contain the card text. A good size for this icon might be 35px high by 55px wide.
			.form-group
				label(for='card_icon_height_input', class='control-label col-xs-2', class=input_status.card_dimensions) Card Icon Dimensions
				.col-xs-5
					.input-group(class=input_status.card_icon_height)
						input(type='text', class='form-control', id='card_icon_height_input', name='card_icon_height', placeholder='Height', value=form_data.card_icon_height, readonly=inputs_disabled)
						span(class='input-group-addon') px
				.col-xs-5
					.input-group(class=input_status.card_icon_width)
						input(type='text', class='form-control', id='card_icon_width_input', name='card_icon_width', placeholder='Width', value=form_data.card_icon_width, readonly=inputs_disabled)
						span(class='input-group-addon') px
			.form-group(class=input_status.mysql_host)
				label(for='mysql_host_input', class='control-label col-xs-2') MYSQL Host
				.col-xs-10
					input(type='text', class='form-control', id='mysql_host_input', name='mysql_host', placeholder='Host', value=form_data.mysql.host, readonly=inputs_disabled)
			.form-group(class=input_status.mysql_port)
				label(for='mysql_port_input', class='control-label col-xs-2') MYSQL Port
				.col-xs-10
					input(type='text', class='form-control', id='mysql_port_input', name='mysql_port', placeholder='Port', value=form_data.mysql.port, readonly=inputs_disabled)
			.form-group(class=input_status.mysql_database)
				label(for='mysql_database_input', class='control-label col-xs-2') MYSQL DB name
				.col-xs-10
					input(type='text', class='form-control', id='mysql_database_input', name='mysql_database', placeholder='Database', value=form_data.mysql.database, readonly=inputs_disabled)
			.form-group(class=input_status.mysql_username)
				label(for='mysql_username_input', class='control-label col-xs-2') MYSQL Username
				.col-xs-10
					input(type='text', class='form-control', id='mysql_username_input', name='mysql_username', placeholder='Username', value=form_data.mysql.username, readonly=inputs_disabled)
			.form-group(class=input_status.mysql_password)
				label(for='mysql_password_input', class='control-label col-xs-2') MYSQL Password
				.col-xs-10
					input(type='password', class='form-control', id='mysql_password_input', name='mysql_password', placeholder='Password', value='', readonly=inputs_disabled)
					span(class='help-block') This will be stored in plaintext in configuration.json.
			.form-group(class=input_status.mysql_connection_limit)
				label(for='mysql_connection_limit_input', class='control-label col-xs-2') MYSQL Connection Limit
				.col-xs-10
					input(type='text', class='form-control', id='mysql_connection_limit_input', name='mysql_connection_limit', placeholder='Limit', value=form_data.mysql.connection_limit, readonly=inputs_disabled)
			.form-group(class=input_status.invitations_required)
				label(for='invitations_required_checkbox', class='control-label col-xs-2') Require Invitations
				.col-xs-10
					input(type='checkbox', class='form-control', style='width: auto;', id='invitations_required_checkbox', name='invitations_required', checked=form_data.invitations_required, disabled=inputs_disabled)
					span(class='help-block') If invitations are required, only those invited by administrators can make accounts. If invitations are not required, anyone can make an account
			.form-group(class=input_status.token_length)
				label(for='token_length_input', class='control-label col-xs-2') Token Length
				.col-xs-10
					input(type='text', class='form-control', id='token_length_input', name='token_length', placeholder='Length', value=form_data.token_length, readonly=inputs_disabled)
					span(class='help-block') Length (in characters) of randomly generated tokens used for things like invitation keys. This number must be even.
			.form-group(class=input_status.username_length)
				label(for='username_length_input', class='control-label col-xs-2') Username Length
				.col-xs-10
					input(type='text', class='form-control', id='username_length_input', name='username_length', placeholder='Length', value=form_data.username_length, readonly=inputs_disabled)
					span(class='help-block') Maximum number of characters allowed in usernames.
			.form-group(class=input_status.deck_name_length)
				label(for='deck_name_length_input', class='control-label col-xs-2') Deck Name Length
				.col-xs-10
					input(type='text', class='form-control', id='deck_name_length_input', name='deck_name_length', placeholder='Length', value=form_data.deck_name_length, readonly=inputs_disabled)
					span(class='help-block') Maximum number of characters allowed in deck names.
			.form-group(class=input_status.card_text_length)
				label(for='card_text_length_input', class='control-label col-xs-2') Card Text Length
				.col-xs-10
					input(type='text', class='form-control', id='card_text_length_input', name='card_text_length', placeholder='Length', value=form_data.card_text_length, readonly=inputs_disabled)
					span(class='help-block') Maximum number of characters allowed per card.
			.form-group(class=input_status.super_user_name)
				label(for='super_user_name_input', class='control-label col-xs-2') Username
				.col-xs-10
					input(type='text', class='form-control', id='super_user_name_input', name='super_user_name', placeholder='Username', value=form_data.super_user_name, readonly=inputs_disabled)
					span(class='help-block') The username to create for you. This user will be the Primary Super User.
			.form-group(class=input_status.super_user_password)
				label(for='super_user_password_input', class='control-label col-xs-2') Password
				.col-xs-10
					input(type='password', class='form-control', id='super_user_password_input', name='super_user_password', placeholder='Password', value='', readonly=inputs_disabled)
			.form-group
				.col-xs-offset-2.col-xs-10
					button(type='submit', class='btn btn-primary', disabled=inputs_disabled) Configure Site

